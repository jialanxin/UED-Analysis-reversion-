import scipy.io as sio
import matplotlib.pyplot as plt
import numpy as np
path = 'Data.mat'
data = sio.loadmat(path)
delays = data['Delays'][5:80, 0]
Timezero = delays[5]
ROI = data['ROIintNorm'][0, 0]['mean']
Qx = data['QxNorm'][0, 0]['mean']
Qy = data['QyNorm'][0, 0]['mean']
Qr = data['QrNorm'][0, 0]['mean']
I2 = ROI[5:80, 2]
Qr2 = Qr[5:80, 2]








def output(xi_g, l, beta, tau, k, s0):
    delta_d = -Qr2
    s = k*delta_d+s0
    frac2 = 1+(xi_g*s)**2
    frac1 = np.sin(np.pi*l*np.sqrt(frac2)/xi_g)**2
    frac3 = (1-beta+beta*np.exp(-delays/tau))
    I = frac1*frac3/frac2
    return I
def lossfunction(xi_g,l,beta,tau,k,s0):
    distance = (output(xi_g, l, beta, tau, k, s0)-I2)*100
    loss = np.sum(np.power(distance,2))
    return loss


# #No.3 Peak
# k,s0,xi_g,l,beta,tau =[0.536327098506547, 0.48202356678813596, 80.67618037592749, 38.45349479628592, 1.3904290798424493e-15, 45.66553298338358]
# #k,s0,xi_g,l,beta,tau=[1.8262891596171347, 0.0028091153717542065, 176.69577398920677, 26.06966034091221, 8.902462436426921e-15, 62.50871670051182]
# #k,s0,xi_g,l,beta,tau=[0.1444852478503182, 0.46849446222085067, 54.06723594748352, 35.47264955252302, 2.5968001913740516e-15, 69.08738901361382]

# #k,s0,xi_g,l,beta,tau=[0.8773581001430097, 0.11529256840446987, 52.440910623960654, 30.20115486996027, 3.0076075886442503e-05, 69.91502569109056]
# #k,s0,xi_g,l,beta,tau=[0.16035158759950835, -0.09588529422531343, 61.11960461053751, 34.539781283717055, 1.129694233103135e-14, 18.52680337073871]
# #No.2 Peak
# #k,s0,xi_g,l,beta,tau=[0.8746565358169908, -0.10859758070744652, 144.48517050096342, 40.99245996152294, 2.5680305397226956e-15, 13.153189123023678]

# #k,s0,xi_g,l,beta,tau =[2.2002936626788476, -0.11053160630145326, 184.71171955433414, 31.257298737141916, 1.0544921662265955e-14, 18.544064282076842]

# plt.figure()
# # plt.plot(delays[:130], ROI[:130,0])
# # plt.plot(delays[:130],ROI[:130,1])
# # plt.plot(delays[:130],ROI[:130,2])
# # plt.plot(delays[:130],ROI[:130,3])
# # plt.plot(delays[:130], 1000*Qr[:130,0])
# # plt.plot(delays[:130],1000*Qr[:130,1])
# # plt.plot(delays[:130],1000*Qr[:130,2])
# # plt.plot(delays[:130],1000*Qr[:130,3])
# plt.xticks((0,200,400,600),(0,200,400,600),fontsize = 30)
# #plt.yticks((-0.02,0,0.03),(-0.02,0,0.03),fontsize=30)
# # plt.yticks((-0.5,0,0.75,1.5),(-0.5,0,0.75,1.5),fontsize=30)
# plt.yticks((-0.01,0,0.01),(-0.01,0,0.01),fontsize=30)
# plt.xlabel('Delay Time(ps)',fontsize = 30)
# # plt.ylabel('Normalized Q-shift($\\times10^{-3}$a.u.)',fontsize = 30)
# plt.ylabel('Normalized Intensity(a.u.)',fontsize = 30)
# #plt.plot(delays[:130],I2[:130])
# plt.plot(delays[:300],output(xi_g,l,beta,tau,k,s0)[:300])
# plt.show()


#v2.0
# k,s0,xi_g,l,beta,tau,A,tdamp,Period = [-0.06971618150701607, 0.44027835874276194, 125.57820842635425, 26.375083912578752, 1.533224275678296e-14, 30.39758032069153, -0.002470223541767595, 2250.9186029584307, 78.2740250228717]
# k,s0,xi_g,l,beta,tau,A,tdamp,Period = [-0.008907947150129271, 0.328025414572736, 89.42138881828262, 34.23721173770589, 1.0405235028863416e-13, 38.864169480839955, 0.005373882206572447, 21793.998560796303, 51.82217553689855]
# plt.figure(1)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period = [-0.17899216237170945, -0.03259631701235128, 41.06817043926556, 34.9222183918154, 2.1269704524476757e-14, 96.15577356759219, -0.007555043209453027, 6674.022942138897, 78.44771984694884]
# plt.figure(2)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period =[-0.14219326871167923, 0.17194599936897548, 196.7485390136003, 45.12703196538678, 8.7874308786204e-14, 68.22729843356547, -0.0002672921857089309, 20646.575846374006, 79.42916616526419]
# plt.figure(3)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period =[12.90015780566107, -0.03180024061059541, 100.86146715693897, 42.992014354852024, 5.502241749158172e-13, 10.837428903390084, 8.534154354327808e-05, 76.22002823434717, 50.12739720738314]
# plt.figure(4)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period = [-0.06027008105688731, -0.1845689027181648, 193.80977387483043, 35.16373964835533, 2.4388358439509625e-15, 12.818400109743704, 0.01747922166722224, 10024.675063124798, 51.46413510587817]
# plt.figure(5)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period = [0.055060819336090916, 0.040738194299808815, 152.79678764581553, 38.827053613038814, 7.625500925076096e-14, 33.41403995480322, 0.0015057686127988308, 12467.717490714214, 70.06925919685622]
# plt.figure(6)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period =[-0.015281796475060798, -0.09354371160600918, 11.4304071508987, 35.01814489782461, 1.0205853762721577e-13, 17.4062108285848, 0.09896073087527744, 2514.5910357118764, 74]
# plt.figure(7)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# plt.show()

#v3.0
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[4.378522069885817, -0.39979150525106144, 52.02635742122853, 26.351999222233967, 7.709881473864465e-13, 48.4723338049633, -0.00021141803774378892, 34.560557483719805, 67.72701928815455, 55.51926659754871]
# plt.figure(1)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.07270885477502455, -0.12605743534492683, 160.81743092129085, 43.95522833216465, 1.881468485509094e-14, 90.46129661333453, -0.003957658927440171, 1711.2315674249082, 77.55056886540203, -13.539732573348381]
#plt.figure(2)
#plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-32.034736830717975, -0.21348661372936337, 176.7333629530804, 35.01710456090824, 6.160500386146359e-14, 16.025648131208584, -3.766396548236236e-05, 492.04996278901456, 61.38210321730094, -131.4755841375578]
#plt.figure(3)
#plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.078474161073203, 0.13320358536525875, 87.96925923293138, 43.34163831397222, 3.111015332968696e-14, 15.019115611033087, -0.00038592734108899266, 8610.923448782138, 55.170013252336524, 2.697576966150038]
#plt.figure(4)
#plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))

#v3.1
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[4.378521918362393, -0.3994606644286788, 52.02635574065317, 26.351994640537992, -0.008180777748610247, 48.472196828321835, -0.00017301875037811695, 34.56026614768546, 67.73368541145211, 55.49274845333452]
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.00851042053773809, -0.3897575977243151, 51.95049272872509, 26.254556154540992, -0.009203433727096132, 39.2968295631601, 0.008510420537738091, 156.170202497254, 86.40694774363635, 55.85141342727552]#v3.1.1
#plt.figure(1)
#plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.07260142361570941, -0.13030503550884964, 160.81742858473436, 43.955239136908205, -0.02153786839890895, 90.46106667817598, -0.00038117619882530696, 1711.2315660088489, 77.55533564080059, -13.540026382166094]
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.005315676311313771, -0.13079902388389372, 160.67393735926217, 43.780369068358816, -0.013036068508213913, 25.94347911198872, -0.0053156763113137665, 1530.5032607973058, 86.04836589474388, -13.310907023991643] #v3.1.1
# plt.figure(2)
# plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-31.42515728073705, -0.21582490709942262, 176.7333126883375, 35.01436421063651, -0.021896682865274148, 16.720506379755744, -4.00151734105156e-06, 484.4519861248381, 71.35115135889909, -130.6962012265816]
# plt.figure(3)
# plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.004875391703485012, 0.1205848241527229, 87.88254264165724, 43.228552278329076, -0.01331668095423487, 25.499429850770795, -0.004875391703485014, 8606.044577168683, 86.0693663438554, 5.536641728883321]#3.1.1
# plt.figure(4)
# plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))

#v4.0
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[9.389769833565628, 0.11516851883434852, 37.51438343295869, 21.086600883734263, 0.004346401405244658, 41.209926977868314, 0.0002527508520834596, 14.418308740285111, 51.03720690470186, -1.181064895573873]
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.04666425887770241, 0.11716157918096673, 36.96523362799892, 20.599825984165797, 0.013331209231392452, 279.2187602231997, 0.04665754533105893, 84.83999416788464, 83.05843497272824, -0.7112764039218922] #v4.1
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[8.083723946554784, 0.11517121532461405, 37.47042467618129, 21.047943722931933, 0.009900276030751292, 135.95712518369604, 0.00021765332372990172, 46.76145069058003, 86.51527467496102, -0.8028879608970334]#4.2
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[7.116907860326869, 0.11475506927267327, 37.448059756741586, 21.026579459458937, 0.012127867153108762, 224.874571799234, 0.0002984136843706382, 83.07706638268168, 83.13822220978591, -0.7135572775125507]#4.3
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[6.897022816174391, 0.11476818612423122, 37.44357610472721, 21.021846204917956, 0.012775467613457202, 271.20756652485494, 0.00030678965981912124, 85.31798273147504, 82.99376032214923, -0.7104886291295281]#4.4
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.04534562330563463, 0.11670110724850419, 37.07004667382929, 20.685893496925463, 0.01819764889906327, 626.781836433764, 0.045336495274129494, 87.23744178601267, 83.00725427214945, -0.711923085973283]#4.5
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.04524547728640656, 0.11700898847432833, 37.015771642528364, 20.632806300039096, 0.02166922706447096, 825.0083792679802, 0.0452451844858905, 88.43765967844969, 82.91777927425903, -0.7105963646864378]#4.6
# A = 0.000526022188918724
# plt.figure(1)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
# plt.figure()
# plt.plot(delays,Qr2)
# plt.plot(delays,Dfunction(A,tdamp,Period,phi)*0.023)
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-0.024636867985090464, 0.16464726475724192, 24.106222129994386, 20.482345604090497, 1.3050847959121315e-13, 82.23675079089617, 0.07131708511709545, 551.0238129070931, 70.0105838507083, 2.811758869378817]
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-0.01031362813008135, 0.18040605425270817, 23.92691679792456, 20.333198240148114, -0.004727207420026125, 7.522175334273499, 0.010313628130081373, 93.89476191634894, 82.00121860027512, 2.2386693875428345] #v4.1
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-0.01022276932169172, 0.1815792906428479, 23.79768052880697, 20.212864749385304, -0.005764209892585393, 7.998475357098753, 0.010222769321691711, 94.89992251851103, 81.53695468329836, 2.199129483847944]#4.2
# plt.figure(2)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[4.8687428854582535, 0.29735459233192, 19.94272616742334, 28.4779290630602, 5.0897155428888846e-15, 71.27604618831701, -3.3977319005209737e-05, 3084.5606820207645, 52.26358652241022, 1.8148492950605712]
# plt.figure(3)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-0.17584674036058748, 0.4416711018612612, 145.24621994254863, 35.090246984654584, 1.3091224322825644e-14, 50.45403525222637, -0.006079275934041689, 2092.9138343036966, 63.70413708282927, 0.23510997109751397]
# plt.figure(4)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-0.013872969248584801, -0.1097460771613619, 94.76475344347209, 22.377405900665043, 1.1990047579317656e-14, 85.38589197571186, 0.12313745049265107, 2111.706863163669, 66.93618236550562, -0.5141968617258262]
# plt.figure(5)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))


#v6.0
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[8.738885555285474, 0.0009897653470479165, 38.43044729287964, 20.557881081333214, 1.8000647028246286e-08, 2200.3092123011215, 0.000259439742585423, 6345.574774926315, 539.9650171541513]
# plt.figure(1)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.014552258365648323, 0.10633795406511092, 20.18595495253185, 12.147827596447192, 0.021517254204924254, 1466.6548495398872, 0.2702387912251527, 1261.7889322740823, 204.03711616311742]
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.06815793817714814, 0.11210042462740046, 21.23912855011784, 11.754642233989674, 0.055738707848741326, 1711.4920832312494, 0.06859751220731353, 281.3654894472607, 198.59737929868052]
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.06898126362107646, 0.11342753872466574, 20.799922085177133, 11.614245135973787, 0.052526884960613474, 1741.9810208261936, 0.06898269713379211, 178.0291555715522, 197.3897204036695]
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.06896547123393414, 0.11287970939853145, 20.600035691356414, 11.6445266310819, 0.05306204149709693, 1763.3091574563293, 0.06896683220861206, 178.15756813586165, 197.37058596621642]
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.06944789041222228, 0.11452904633896481, 20.33489770984672, 11.47959655546995, 0.053238068345140194, 1771.08077040595, 0.0694478951656285, 178.05751485051795, 197.39071631313325]
# plt.figure(2)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.01585799539786208, 0.21348252774706708, 118.00449061650261, 11.468184300268614, 1.2312796679082281e-05, 1894.0263429920035, 0.18127386260124723, 2450.5564428883417, 141.14073861776197]
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.06766016672574046, 0.22154939740271307, 118.50011018756744, 11.093372958407128, 0.07093610411145278, 2486.545556155067, 0.06766016690741121, 178.41220984157337, 197.339281518403]
# plt.figure(3)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[44.45161301745912, -0.3683133491346599, 22.071084233902337, 12.047145510203721, 1.1233211856187314e-08, 1139.185680107287, 6.880934958860367e-05, 11202.406711412723, 191.73265493639448]
# plt.figure(4)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.029929257192973138, -0.1275886057096787, 61.78937208479291, 28.837706752374903, 1.3462474232866695e-09, 2914.410037612053, 0.002181870608474745, 5374.905107570956, 200.28568850359642]
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.03625735271029513, -0.1201675731937195, 61.4212696033095, 28.674440818241493, -0.007930140829216187, 2560.4295392977883, 0.03625734908236662, 3981.452514763592, 206.42308727341072]
# plt.figure(5)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# plt.show()


#v6.1
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[0.0013670102847340077, -0.006535738016287347, 74.72187738442261, 95.33507109884502, 1.1374190459599259e-07, 1785.8241343442744, 0.5916465089083937, 3821.1411946255557, 81.67989288653281]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[0.02671286273547126, -0.007659547407356001, 76.21072942322441, 93.54541397128534, -0.005961243731839883, 1641.79479797605, 0.026712862735471285, 3160.5720476046213, 80.29611585944954]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[0.027749433341282194, -0.008823674448034561, 77.20145776422812, 90.68349062504629, 0.018565974918870003, 1624.9050150066314, 0.027749433341282118, 958.22738732788, 80.83130479307344]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# plt.figure(1)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.11277820098643956, -0.03063224089565105, 104.96118341440702, 25.1346745320804, 3.521715730544723e-09, 1226.5104090351363, 0.00033221255174662064, 4519.493714541855, 72.5702366959458]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.014367214393354758, -0.026773135505149367, 114.76437290322258, 6.011860299133392, -0.014576457229115443, 16.586597902541424, 0.014367214393354713, 3094.3965107225154, 80.6661641569962]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# plt.figure(2)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-2.719875445785884, 0.0015374349083913006, 141.5167807023351, 173.46671610428896, 6.378188413462189e-09, 2047.063662119017, 2.3002511705685797e-05, 2273.3238525472357, 64.7019009438598]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.022606659752523586, -0.0012907846489571525, 123.07999709828874, 180.20904729075346, 0.034857176820928766, 2154.47395683819, 0.022606659752258684, 79.98861842292533, 101.27933541464131]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# plt.figure(3)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[0.009787001615265847, 0.12348309894961516, 161.5079068485195, 11.639363820440732, 0.03717444759215901, 1961.2678129101598, 0.3571594774772618, 578.4311987292704, 87.43789598978155]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[0.05088566005391307, 0.13201987028018472, 160.8165024916813, 10.996898206979358, 0.04188656685941563, 2429.6721226347645, 0.05088566005392245, 87.44735739820888, 99.56935309666775]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# plt.figure(4)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.11796239674060788, -0.06572629723803179, 129.56220161189327, 21.7541554737817, 4.043629973640845e-09, 446.47158879595054, 0.013519549295346687, 7553.583285691055, 86.46704571419662]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.004737617100669105, -0.08407864317388339, 127.76562993835019, 19.374211538167113, -0.014132794035363789, 16.828369653654626, 0.004737617100669131, 7073.544756751724, 88.59875522417677]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# plt.figure(5)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[0.021353060726865384, 0.06809415547786958, 62.13348614209503, 21.503474876869095, 4.07884845114437e-08, 2728.2661918222293, 0.0167652347105141, 4653.552869438972, 85.27383298984829]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[0.042134980618378004, 0.0679333137096636, 58.71278393556958, 20.56466438656926, 0.008069865450999008, 2399.91909756062, 0.04213498061837828, 1784.8566676809198, 85.37046407455676]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# plt.figure(6)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# xi_g,l,beta,tau,k,s0,A,tdamp,Period=[ 1.59988203e+02,  4.46904985e+01, -1.81872110e-02,  1.41720617e+01,-1.73710486e-03, -7.11447016e+00, -7.46505138e-04,  5.23407170e+02,4.80671389e+01]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[10.0, -0.10000000149011612, 200.0, 60.0, 0.003915744865759147, 0.7555156130333966, 1.0000000116860974e-07, 74.25138529533034, 100.49547595851752]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[18.939977634378927, -0.10000000149011612, 137.67712688406905, 60.0, 1.0000000116860974e-07, 1.0000000116860974e-07, 1.0000000116860974e-07, 90.3815594983474, 101.38382300462528]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[15.50728542347391, -0.10000000149011612, 200.0, 60.0, 0.01984685925496434, 1.1292871974141527, 1.0000000116860974e-07, 50.66929016926171, 104.12895389256562]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[15.20908411541069, -0.10000000149011612, 177.03576189202403, 20.0, 0.004989278909373198, 100.0, 1.0000000116860974e-07, 57.18528392238193, 107.11603107528357]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-20.0, 0.10000000149011612, 155.50705899534717, 60.0, 0.0052688666326317635, 100.0, 1.0000000116860974e-07, 55.8891679530352, 108.82061048506604]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-13.449341517817018, 0.10000000149011612, 200.0, 80.0, 0.008944614546625436, 200.0, 1.0000000116860974e-07, 40.724643157374324, 120.0]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-8.97032301570425, 0.15000000596046448, 199.98578831047962, 80.0, 0.008993697115706467, 200.0, 1.0000000116860974e-07, 39.82273637932198, 120.0]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-10.926979679729248, 0.20000000298023224, 155.5790313029995, 80.0, 0.008569973700869097, 200.0, 1.0000000116860974e-07, 40.849165624197916, 120.0]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-27.865596457259997, 0.30000001192092896, 81.18921238383149, 30.0, 0.011064107962310209, 300.0, 1.0000000116860974e-07, 32.96283781840904, 140.0]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-30.0, 0.4000000059604645, 68.80275585879495, 120.0, 0.013625269037509696, 400.0, 1.0000000116860974e-07, 29.38209156913301, 180.0]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-1.9590971762601155, 0.800000011920929, 180.7815717300161, 240.0, 0.015549781635743987, 800.0, 1.0000000116860974e-07, 30.505927091212737, 157.808605985787]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-4.262957500860891, 0.800000011920929, 126.8883663229139, 240.0, 0.019518215897095705, 800.0, 1.0000000116860974e-07, 30.296948773422667, 264.52128219181367]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-60.0, 0.9720334362384571, 10.0, 277.47849861807236, 0.024996727652430172, 1184.649885884481, 1.0000000116860974e-07, 24.769958599583795, 260.5498029153867]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-32.48740728178952, 1.600000023841858, 81.97788943411945, 285.0417539108241, 0.02631635592935457, 1135.22105275527, 1.0000000116860974e-07, 25.45298278881243, 360.0]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-40.68125687520003, 1.025454022564196, 55.60963515220627, 319.91869173117647, 0.02802972073216052, 1224.5669156275574, 1.0000000116860974e-07, 28.533361885834974, 355.76594182426726]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-47.647311275012676, 0.14561519803286505, 50.52747591238019, 443.45715429326947, 0.036721424206511935, 1600.0, 1.0000000116860974e-07, 33.75517912987662, 360.0]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-30.96978486505606, 1.0505107485937648, 53.956149338869885, 269.4113653723139, 0.020393419229951814, 0.8510334037432239, 1.0000000116860974e-07, 48.4865550271472, 113.61044215615999]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-60.0, 1.5608956822987443, 41.266629663224634, 317.8175708271909, 0.09288876182295802, 0.3134092651642682, 1.0000000116860974e-07, 42.93018112090387, 109.35367639340842]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-30.96890676760426, 1.0519850744622259, 53.95467854817096, 269.4128515523135, 0.030043034404195566, 0.8639467905665054, 3.51273546622157e-06, 48.10365637135125, 113.22376240511556]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-100.0, 0.8628959134012782, 116.75087009971965, 417.54435932153297, 0.5420595193428672, 1.0000000116860974e-07, 1.0000000116860974e-07, 65.02095085461418, 103.03560554213779]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-18.472477612194936, 1.600000023841858, 49.98481978762447, 480.0, 0.11491280274158173, 0.3250887986816123, 1.0000000116860974e-07, 41.007107555646286, 107.0293670716278]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-2.6027870817045917, 1.600000023841858, 131.66772767751732, 480.0, 0.27983768926922997, 0.22310169224589896, 1.0000000116860974e-07, 38.35623003114755, 109.47879663515496]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-0.3903171545979099, 6.007453376468793e-05, 173.9737929675735, 1.6024255835194285, 0.02114994371610727, 800.0, 0.13820811618949536, 179.58237320365328, 196.4095253813857]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))

# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[0.677984438535062, 0.0, 11.177879588637706, 0.1743587370079215, 0.021257340829257454, 799.9999999460496, 0.7307965170360465, 180.26992107573307, 196.33988972062807]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))





#ver 8.0 (sin)
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-119.99497053744194, -0.13395283053328383, 102.05137811387986, 454.06180507384374, 1.0000000116860974e-07, 1599.9091954929152, 1.0000000116860974e-07, 3.7661113223666307, 171.9650565520039]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-62.95868526250822, 0.00795868684946522, 10.000000322090992, 22.976984537072905, 0.0031012998576960536, 210.44336602641454, 0.005396022588867386, 4.61569213583547, 359.99999999919555]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-119.99391999334054, 0.4584320991526302, 110.9326601304409, 403.4577266973594, 0.9960000000000008, 1.0000000116860974e-07, 1.0000000116860974e-07, 3.392723652925199, 359.4999200022215]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-17.220919859133225, -0.007485477040553696, 10.000074059346565, 22.840556019991986, 0.012544114002177227, 1599.9999999864963, 0.018589548577829584, 4.595973845719744, 359.7388606996482]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))

# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[0.5179069975333074, 0.012299022435238555, 10.000129609133449, 13.125175790956877, 1.0000000116860974e-07, 31.404218965789948, 0.20221919800929875, 4.60494639334949, 71.74199447696962]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-120.0, -1.600000023841858, 143.32662635096315, 480.0, 1.7119335334853018e-07, 1.0000000116860974e-07, 1.0000000116860974e-07, 3.6821938027809327, 360.0]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))



#with out normalization
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[1.633403634410518, 0.06277241353100127, 87.55923492443245, 4.098785631155757, 1.0000000116860974e-07, 1.0000000116860974e-07, 0.17917884753842855, 32.95812197401751, 101.37854558142605]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[1.7306793649253163, -0.013877033789788284, 10.0, 0.5242215884579271, 1.0, 764.7393435102997, 1.0, 126.69645210929694, 204.05391680861544]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))

# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[3.4020763408040966, -1.3393182087455433, 4.1561257588057705, 376.6217370633944, 0.5636156131021897, 228.22258217852132, 0.000387843843691376, 138.5182038878456, 194.72937306309046]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[1.7306793649253163, -0.013877033789788284, 10.0, 0.5242215884579271, 1.0, 764.7393435102997, 1.0, 126.69645210929694, 102.0]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))

# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[-5.125725115723076, -0.001906584570215549, 78.96525783846008, 4.035921436988886, 0.5795597201913947, 391.51838110744325, 0.04877241207755415, 84.81639953484701, 180.0]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))




#restrict period in 65~85 picoseconds
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[10.0, -0.9186404690295147, 5.4685485618236545, 12.000323668206557, 1.0000000116860974e-07, 1.0000000116860974e-07, 7.00410654528079, 6.901106233690124, 85.0]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[1.8255844482471348, -0.30899518950729843, 15.34569125368395, 38.792979300271654, 0.555947228553171, 660.036444401139, 6.980894584722704, 8.689439286384639, 84.59876420317622]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period=[5.119326322937469, -1.0126345132279386, 4.219269407806254, 167.98235059258195, 0.46682576669326903, 1.0000020864557645e-07, 8.943706659008337, 5.678710908931804, 65.16863982914418]
# print(lossfunction(xi_g,l,beta,tau,k,s0,A,tdamp,Period))



#go back and try to fit directly from q-shift using PSO
k,s0,xi_g,l,beta,tau=[-1.2825253703528963, -1.600000023841858, 1.0, 107.18897816374253, 0.857319691709224, 1.0000000116860974e-07]
print(lossfunction(xi_g,l,beta,tau,k,s0))
k,s0,xi_g,l,beta,tau=[1.821341988718683, 0.14941967495218372, 32.106473175645945, 67.101101322337, 0.20174751941184701, 1600.0]
print(lossfunction(xi_g,l,beta,tau,k,s0))
k,s0,xi_g,l,beta,tau=[1.5266419491724383, 0.12696610552519233, 39.70671126502544, 86.96695250627475, 0.20825976333460636, 1599.9124776337694]
print(lossfunction(xi_g,l,beta,tau,k,s0))
k,s0,xi_g,l,beta,tau=[-6.775588403827548, 0.21651306676143417, 25.378883143585398, 21.414358384982364, 0.2039517978992194, 1596.580751258942]
print(lossfunction(xi_g,l,beta,tau,k,s0))
k,s0,xi_g,l,beta,tau=[3.9045677066495053, 1.1023518810431414, 4.514962345838815, 33.13183387986024, 0.2063924230597383, 1600.0]
print(lossfunction(xi_g,l,beta,tau,k,s0))
k,s0,xi_g,l,beta,tau=[2.430506868722627, 0.871923178049203, 5.788849781787501, 54.29071786951386, 0.20805118785770246, 1600.0]
print(lossfunction(xi_g,l,beta,tau,k,s0))
plt.figure(1)
plt.plot(delays[:],I2[:])
plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0))
plt.show()
