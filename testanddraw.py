import scipy.io as sio
import matplotlib.pyplot as plt
import numpy as np
path = 'Data.mat'
data = sio.loadmat(path)
delays = data['Delays'][5:135, 0]
print(delays.shape)
Timezero = delays[5]
ROI = data['ROIintNorm'][0, 0]['mean']
Qx = data['QxNorm'][0, 0]['mean']
Qy = data['QyNorm'][0, 0]['mean']
Qr = data['QrNorm'][0, 0]['mean']
I2 = ROI[5:135, 2]
Qr2 = Qr[5:135, 2]


def Dfunction(A,tdamp,Period,phi):
    delta_d = A*np.exp(-delays/tdamp)*np.cos(2*np.pi*delays/Period+phi)
    return delta_d
def sfunction(k, s0,A,tdamp,Period,phi):
    s = k*Dfunction(A,tdamp,Period,phi)+s0
    return s


def Ifunction(xi_g, l, beta, tau, k, s0, A,tdamp,Period,phi):
    frac2 = 1+(xi_g*sfunction(k,s0,A,tdamp,Period,phi))**2
    frac1 = np.sin(np.pi*l*np.sqrt(frac2)/xi_g)**2
    frac3 = (1-beta+beta*np.exp(-delays/tau))
    I = frac1*frac3/frac2
    return I


def output(xi_g, l, beta, tau, k, s0,A,tdamp,Period,phi):
    I = Ifunction(xi_g, l, beta, tau, k, s0,A,tdamp,Period,phi)
    I0 = I[0]
    ratio = (I - I0)/I0
    return ratio


# #No.3 Peak
# k,s0,xi_g,l,beta,tau =[0.536327098506547, 0.48202356678813596, 80.67618037592749, 38.45349479628592, 1.3904290798424493e-15, 45.66553298338358]
# #k,s0,xi_g,l,beta,tau=[1.8262891596171347, 0.0028091153717542065, 176.69577398920677, 26.06966034091221, 8.902462436426921e-15, 62.50871670051182]
# #k,s0,xi_g,l,beta,tau=[0.1444852478503182, 0.46849446222085067, 54.06723594748352, 35.47264955252302, 2.5968001913740516e-15, 69.08738901361382]

# #k,s0,xi_g,l,beta,tau=[0.8773581001430097, 0.11529256840446987, 52.440910623960654, 30.20115486996027, 3.0076075886442503e-05, 69.91502569109056]
# #k,s0,xi_g,l,beta,tau=[0.16035158759950835, -0.09588529422531343, 61.11960461053751, 34.539781283717055, 1.129694233103135e-14, 18.52680337073871]
# #No.2 Peak
# #k,s0,xi_g,l,beta,tau=[0.8746565358169908, -0.10859758070744652, 144.48517050096342, 40.99245996152294, 2.5680305397226956e-15, 13.153189123023678]

# #k,s0,xi_g,l,beta,tau =[2.2002936626788476, -0.11053160630145326, 184.71171955433414, 31.257298737141916, 1.0544921662265955e-14, 18.544064282076842]

# plt.figure()
# # plt.plot(delays[:130], ROI[:130,0])
# # plt.plot(delays[:130],ROI[:130,1])
# # plt.plot(delays[:130],ROI[:130,2])
# # plt.plot(delays[:130],ROI[:130,3])
# # plt.plot(delays[:130], 1000*Qr[:130,0])
# # plt.plot(delays[:130],1000*Qr[:130,1])
# # plt.plot(delays[:130],1000*Qr[:130,2])
# # plt.plot(delays[:130],1000*Qr[:130,3])
# plt.xticks((0,200,400,600),(0,200,400,600),fontsize = 30)
# #plt.yticks((-0.02,0,0.03),(-0.02,0,0.03),fontsize=30)
# # plt.yticks((-0.5,0,0.75,1.5),(-0.5,0,0.75,1.5),fontsize=30)
# plt.yticks((-0.01,0,0.01),(-0.01,0,0.01),fontsize=30)
# plt.xlabel('Delay Time(ps)',fontsize = 30)
# # plt.ylabel('Normalized Q-shift($\\times10^{-3}$a.u.)',fontsize = 30)
# plt.ylabel('Normalized Intensity(a.u.)',fontsize = 30)
# #plt.plot(delays[:130],I2[:130])
# plt.plot(delays[:300],output(xi_g,l,beta,tau,k,s0)[:300])
# plt.show()


#v2.0
# k,s0,xi_g,l,beta,tau,A,tdamp,Period = [-0.06971618150701607, 0.44027835874276194, 125.57820842635425, 26.375083912578752, 1.533224275678296e-14, 30.39758032069153, -0.002470223541767595, 2250.9186029584307, 78.2740250228717]
# k,s0,xi_g,l,beta,tau,A,tdamp,Period = [-0.008907947150129271, 0.328025414572736, 89.42138881828262, 34.23721173770589, 1.0405235028863416e-13, 38.864169480839955, 0.005373882206572447, 21793.998560796303, 51.82217553689855]
# plt.figure(1)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period = [-0.17899216237170945, -0.03259631701235128, 41.06817043926556, 34.9222183918154, 2.1269704524476757e-14, 96.15577356759219, -0.007555043209453027, 6674.022942138897, 78.44771984694884]
# plt.figure(2)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period =[-0.14219326871167923, 0.17194599936897548, 196.7485390136003, 45.12703196538678, 8.7874308786204e-14, 68.22729843356547, -0.0002672921857089309, 20646.575846374006, 79.42916616526419]
# plt.figure(3)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period =[12.90015780566107, -0.03180024061059541, 100.86146715693897, 42.992014354852024, 5.502241749158172e-13, 10.837428903390084, 8.534154354327808e-05, 76.22002823434717, 50.12739720738314]
# plt.figure(4)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period = [-0.06027008105688731, -0.1845689027181648, 193.80977387483043, 35.16373964835533, 2.4388358439509625e-15, 12.818400109743704, 0.01747922166722224, 10024.675063124798, 51.46413510587817]
# plt.figure(5)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period = [0.055060819336090916, 0.040738194299808815, 152.79678764581553, 38.827053613038814, 7.625500925076096e-14, 33.41403995480322, 0.0015057686127988308, 12467.717490714214, 70.06925919685622]
# plt.figure(6)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period =[-0.015281796475060798, -0.09354371160600918, 11.4304071508987, 35.01814489782461, 1.0205853762721577e-13, 17.4062108285848, 0.09896073087527744, 2514.5910357118764, 74]
# plt.figure(7)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period))
# plt.show()

#v3.0
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[4.378522069885817, -0.39979150525106144, 52.02635742122853, 26.351999222233967, 7.709881473864465e-13, 48.4723338049633, -0.00021141803774378892, 34.560557483719805, 67.72701928815455, 55.51926659754871]
# plt.figure(1)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.07270885477502455, -0.12605743534492683, 160.81743092129085, 43.95522833216465, 1.881468485509094e-14, 90.46129661333453, -0.003957658927440171, 1711.2315674249082, 77.55056886540203, -13.539732573348381]
#plt.figure(2)
#plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-32.034736830717975, -0.21348661372936337, 176.7333629530804, 35.01710456090824, 6.160500386146359e-14, 16.025648131208584, -3.766396548236236e-05, 492.04996278901456, 61.38210321730094, -131.4755841375578]
#plt.figure(3)
#plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.078474161073203, 0.13320358536525875, 87.96925923293138, 43.34163831397222, 3.111015332968696e-14, 15.019115611033087, -0.00038592734108899266, 8610.923448782138, 55.170013252336524, 2.697576966150038]
#plt.figure(4)
#plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))

#v3.1
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[4.378521918362393, -0.3994606644286788, 52.02635574065317, 26.351994640537992, -0.008180777748610247, 48.472196828321835, -0.00017301875037811695, 34.56026614768546, 67.73368541145211, 55.49274845333452]
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.00851042053773809, -0.3897575977243151, 51.95049272872509, 26.254556154540992, -0.009203433727096132, 39.2968295631601, 0.008510420537738091, 156.170202497254, 86.40694774363635, 55.85141342727552]#v3.1.1
#plt.figure(1)
#plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.07260142361570941, -0.13030503550884964, 160.81742858473436, 43.955239136908205, -0.02153786839890895, 90.46106667817598, -0.00038117619882530696, 1711.2315660088489, 77.55533564080059, -13.540026382166094]
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.005315676311313771, -0.13079902388389372, 160.67393735926217, 43.780369068358816, -0.013036068508213913, 25.94347911198872, -0.0053156763113137665, 1530.5032607973058, 86.04836589474388, -13.310907023991643] #v3.1.1
# plt.figure(2)
# plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-31.42515728073705, -0.21582490709942262, 176.7333126883375, 35.01436421063651, -0.021896682865274148, 16.720506379755744, -4.00151734105156e-06, 484.4519861248381, 71.35115135889909, -130.6962012265816]
# plt.figure(3)
# plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.004875391703485012, 0.1205848241527229, 87.88254264165724, 43.228552278329076, -0.01331668095423487, 25.499429850770795, -0.004875391703485014, 8606.044577168683, 86.0693663438554, 5.536641728883321]#3.1.1
# plt.figure(4)
# plt.plot(delays[:],I2[:])
#plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))

#v4.0
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[9.389769833565628, 0.11516851883434852, 37.51438343295869, 21.086600883734263, 0.004346401405244658, 41.209926977868314, 0.0002527508520834596, 14.418308740285111, 51.03720690470186, -1.181064895573873]
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.04666425887770241, 0.11716157918096673, 36.96523362799892, 20.599825984165797, 0.013331209231392452, 279.2187602231997, 0.04665754533105893, 84.83999416788464, 83.05843497272824, -0.7112764039218922] #v4.1
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[8.083723946554784, 0.11517121532461405, 37.47042467618129, 21.047943722931933, 0.009900276030751292, 135.95712518369604, 0.00021765332372990172, 46.76145069058003, 86.51527467496102, -0.8028879608970334]#4.2
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[7.116907860326869, 0.11475506927267327, 37.448059756741586, 21.026579459458937, 0.012127867153108762, 224.874571799234, 0.0002984136843706382, 83.07706638268168, 83.13822220978591, -0.7135572775125507]#4.3
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[6.897022816174391, 0.11476818612423122, 37.44357610472721, 21.021846204917956, 0.012775467613457202, 271.20756652485494, 0.00030678965981912124, 85.31798273147504, 82.99376032214923, -0.7104886291295281]#4.4
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.04534562330563463, 0.11670110724850419, 37.07004667382929, 20.685893496925463, 0.01819764889906327, 626.781836433764, 0.045336495274129494, 87.23744178601267, 83.00725427214945, -0.711923085973283]#4.5
k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[0.04524547728640656, 0.11700898847432833, 37.015771642528364, 20.632806300039096, 0.02166922706447096, 825.0083792679802, 0.0452451844858905, 88.43765967844969, 82.91777927425903, -0.7105963646864378]#4.6
A = 0.000526022188918724
# plt.figure(1)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
plt.figure()
plt.plot(delays,Qr2)
plt.plot(delays,Dfunction(A,tdamp,Period,phi)*0.023)
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-0.024636867985090464, 0.16464726475724192, 24.106222129994386, 20.482345604090497, 1.3050847959121315e-13, 82.23675079089617, 0.07131708511709545, 551.0238129070931, 70.0105838507083, 2.811758869378817]
#k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-0.01031362813008135, 0.18040605425270817, 23.92691679792456, 20.333198240148114, -0.004727207420026125, 7.522175334273499, 0.010313628130081373, 93.89476191634894, 82.00121860027512, 2.2386693875428345] #v4.1
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-0.01022276932169172, 0.1815792906428479, 23.79768052880697, 20.212864749385304, -0.005764209892585393, 7.998475357098753, 0.010222769321691711, 94.89992251851103, 81.53695468329836, 2.199129483847944]#4.2
# plt.figure(2)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[4.8687428854582535, 0.29735459233192, 19.94272616742334, 28.4779290630602, 5.0897155428888846e-15, 71.27604618831701, -3.3977319005209737e-05, 3084.5606820207645, 52.26358652241022, 1.8148492950605712]
# plt.figure(3)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-0.17584674036058748, 0.4416711018612612, 145.24621994254863, 35.090246984654584, 1.3091224322825644e-14, 50.45403525222637, -0.006079275934041689, 2092.9138343036966, 63.70413708282927, 0.23510997109751397]
# plt.figure(4)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
# k,s0,xi_g,l,beta,tau,A,tdamp,Period,phi=[-0.013872969248584801, -0.1097460771613619, 94.76475344347209, 22.377405900665043, 1.1990047579317656e-14, 85.38589197571186, 0.12313745049265107, 2111.706863163669, 66.93618236550562, -0.5141968617258262]
# plt.figure(5)
# plt.plot(delays[:],I2[:])
# plt.plot(delays[:],output(xi_g,l,beta,tau,k,s0,A,tdamp,Period,phi))
plt.show()
